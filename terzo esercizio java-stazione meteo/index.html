<!DOCTYPE html>

<head>
    <title>Meteo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        button {
            padding: 10px;
            margin-top: 20px;
            border: none;
            background-color: #007BFF;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        #dati-meteo {
            margin-top: 20px;
            width: 80%;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <header></header>
    <main>
        <h1>Benvenuto <span id="nome-utente"></span></h1>
        <input type="text" id="citta-input" placeholder="Inserisci la tua città" />
        <button onclick="richiesta_async()">Cerca Meteo</button>
        
        <div id="dati-meteo"></div>
    </main>

    <script>
        function logout() {
            localStorage.removeItem("utente");
            window.location.href = "dashboard.html";
        }

        let utente = JSON.parse(localStorage.getItem("utente"));
        document.getElementById("nome-utente").innerHTML = utente.username;


        async function richiesta_async() {
            let citta = document.getElementById("citta-input").value;
            if (!citta) {
                alert("Inserisci una città.");
                return; 
            }

            const apiKey = "cac078cab5bd473d844124923240710"; 
            let risposta = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${citta}&aqi=no`);
            let datiMeteo = await risposta.json();

            if (datiMeteo.error) {
                alert("Città non trovata. Controlla il nome e riprova.");
                document.getElementById("dati-meteo").innerHTML = ''; // Pulisce i dati precedenti
                return;
            }
            crea_dati_meteo(datiMeteo);
        }


        function crea_dati_meteo(datiMeteo) {
            const datiMeteoDiv = document.getElementById("dati-meteo");
            datiMeteoDiv.innerHTML = ''; 

            let h2 = document.createElement("h2");
            h2.innerHTML = `Meteo per ${datiMeteo.location.name}, ${datiMeteo.location.country}`;
            let temp = document.createElement("p");
            temp.innerHTML = `Temperatura: ${datiMeteo.current.temp_c} °C`;
            let condition = document.createElement("p");
            condition.innerHTML = `Condizione: ${datiMeteo.current.condition.text}`;
            let icon = document.createElement("img");
            icon.src = datiMeteo.current.condition.icon;
            icon.alt = datiMeteo.current.condition.text;

            datiMeteoDiv.appendChild(h2);
            datiMeteoDiv.appendChild(temp);
            datiMeteoDiv.appendChild(condition);
            datiMeteoDiv.appendChild(icon);
        }
    </script>
    <footer>
        <button onclick="logout()">Logout</button>
    </footer>
</body>
</html>
