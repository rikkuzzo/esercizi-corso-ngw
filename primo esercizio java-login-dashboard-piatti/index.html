<!DOCTYPE html>

<head>
    <title>Accesso</title>
    
</head>
<body>
    <header></header>
    <main>
        <h1>Ti sei loggato</h1>
        <h2>Benvenuto <span id="nome-utente"></span></h2>
        <button onclick="logout_to_index()">Logout</button>
        
        <div id="sezione-piatti"></div>
        <button onclick="richiesta_async()">Cerca un piatto</button>
    </main>

    <script>

        function logout_to_index() {
            localStorage.removeItem("utente");
            window.location.href = "dashboard.html";
        }


        let utente = JSON.parse(localStorage.getItem("utente"));
        document.getElementById("nome-utente").innerHTML = utente.username;


        function crea_card_listapiatti(lista_piatti) {
            const sezionePiatti = document.getElementById("sezione-piatti");
            sezionePiatti.innerHTML = ''; 
            for (let i = 0; i < lista_piatti.length; i++) {
                let div = document.createElement("div");
                div.className = "piatto";
                
                let hNomePiatto = document.createElement("h3");
                hNomePiatto.innerHTML = lista_piatti[i].strMeal;

                let imagePiatto = document.createElement("img");
                imagePiatto.src = lista_piatti[i].strMealThumb;
                
                let instrPiatto = document.createElement("p");
                instrPiatto.innerHTML = lista_piatti[i].strInstructions;

                div.appendChild(hNomePiatto);
                div.appendChild(imagePiatto);
                div.appendChild(instrPiatto);

                sezionePiatti.appendChild(div);
            }
        }


        async function richiesta_async() {
            let input = prompt("Quale piatto vuoi cercare?");
            if (!input) return; 

            let risposta = await fetch(`https://www.themealdb.com/api/json/v1/1/search.php?s=${input}`);
            let lista_piatti = await risposta.json();
            
            if (lista_piatti.meals) {
                crea_card_listapiatti(lista_piatti.meals);
            } else {
                alert("Nessun piatto trovato.");
            }
        }
    </script>
    <footer></footer>
</body>
</html>
